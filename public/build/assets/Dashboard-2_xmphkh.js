import{_ as b}from"./AuthenticatedLayout-BK8eRcyi.js";import{o as e,f as o,b as t,i as h,k as m,g as d,e as g,F as p,m as v,l as k,t as i,c as y,a as _,u as w,w as f,Z as $}from"./app-C-bjOtg-.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{P as j}from"./Pagination-BVpQPrkm.js";import"./ApplicationLogo-eBP8HNVI.js";const x={data(){return{form:{group:null,max_post_count:30}}},computed:{user(){return window.user}},watch:{"form.group":{handler:function(n){if(this.form.group.indexOf("http")!==-1){let s=this.form.group.lastIndexOf("/")+1;this.form.group=this.form.group.substring(s)}},deep:!0}},methods:{submit(){this.$store.dispatch("addWork",this.form).then(n=>{const s=new CustomEvent("jobs-reload-event");document.dispatchEvent(s)})}}},V={class:"form-floating mb-3"},q={class:"form-floating mb-3"},I={key:0,class:"alert alert-light my-2"},O={class:"d-flex w-100 justify-center"},P=["disabled"],C={class:"d-flex w-100 justify-center mb-2"},E=["href"];function T(n,s,l,r,a,u){return e(),o(p,null,[t("form",{onSubmit:s[2]||(s[2]=g((...c)=>u.submit&&u.submit(...c),["prevent"])),class:"mb-2"},[t("div",V,[h(t("input",{type:"text",class:"form-control","onUpdate:modelValue":s[0]||(s[0]=c=>a.form.group=c),id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[m,a.form.group]]),s[3]||(s[3]=t("label",{for:"floatingInput"},"Группа",-1))]),s[5]||(s[5]=t("div",{class:"alert alert-info rounded-0"}," Количество постов, которые можно охватить. Чем больше глубина тем дольше время ожидания обработки. Рекомендуемое значение от 30 до 100 в зависимости от числа подписчиков в группе. Чем больше подписчиков тем ниже должна быть глубина обработки. ",-1)),t("div",q,[h(t("input",{type:"number",class:"form-control","onUpdate:modelValue":s[1]||(s[1]=c=>a.form.max_post_count=c),max:"100",id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[m,a.form.max_post_count]]),s[4]||(s[4]=t("label",{for:"floatingInput"},"Глубина обработки страницы",-1))]),u.user.is_active_token?d("",!0):(e(),o("div",I," Ваш тоукен недействительный! Обновите его! ")),t("div",O,[t("button",{disabled:!u.user.is_active_token,class:"btn btn-primary rounded-0"},"Добавить задачу ",8,P)])],32),t("div",C,[n.link?(e(),o("a",{key:0,class:"btn btn-success rounded-0",href:n.link},"Запустить процесс",8,E)):d("",!0)])],64)}const B=J(x,[["render",T]]),K={key:0,class:"row"},D={class:"col-12"},F={class:"table"},N={scope:"row"},L={key:0},M={key:1},S=["onClick"],U={key:1,class:"alert alert-light"},G={key:2,class:"row mb-3"},R={class:"col-12"},W={data(){return{current_page:0,jobs:[],pagination:null}},computed:{...v(["getJobs","getJobsPaginateObject"])},mounted(){this.loadJobs(),document.addEventListener("jobs-reload-event",n=>{this.loadJobs()})},methods:{removeJob(n){this.$store.dispatch("removeJob",{id:n.id}).then(s=>{this.loadJobs()})},loadJobs(n=0){this.current_page=n,this.$store.dispatch("loadJobs",{page:this.current_page}).then(s=>{this.jobs=this.getJobs,this.pagination=this.getJobsPaginateObject})}}},Z=Object.assign(W,{__name:"JobsTable",setup(n){return(s,l)=>(e(),o(p,null,[s.jobs.length>0?(e(),o("div",K,[t("div",D,[t("table",F,[l[0]||(l[0]=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"#"),t("th",{scope:"col"},"Группа"),t("th",{scope:"col"},"Максимальный охват"),t("th",{scope:"col"},"Собрано пользователей"),t("th",{scope:"col"},"Статус"),t("th",{scope:"col"},"Дата добавления"),t("th",{scope:"col"},"Действие")])],-1)),t("tbody",null,[(e(!0),o(p,null,k(s.jobs,(r,a)=>(e(),o("tr",null,[t("th",N,i(a+1),1),t("td",null,i(r.group),1),t("td",null,i(r.max_post_count),1),t("td",null,i(r.result_count),1),t("td",null,[r.completed_at==null?(e(),o("span",L,"В обработке")):(e(),o("span",M,"Завершено"))]),t("td",null,i(r.created_at),1),t("td",null,[t("button",{onClick:u=>s.removeJob(r),class:"btn btn-danger"},"Удалить",8,S)])]))),256))])])])])):(e(),o("div",U," Вы еще не добавили задачи в очередь! ")),s.jobs.length>0?(e(),o("div",G,[t("div",R,[s.pagination?(e(),y(j,{key:0,onPagination_page:s.loadJobs,pagination:s.pagination},null,8,["onPagination_page","pagination"])):d("",!0)])])):d("",!0)],64))}}),z={class:"py-12"},A={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},H={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Q={class:"row p-3"},X={class:"col-4"},Y={class:"card"},tt={class:"card-body"},st={key:0,class:"list-group"},et={class:"list-group-item"},ot={class:"list-group-item"},nt={class:"list-group-item"},lt={key:0},it={key:1},rt={class:"list-group-item"},at={key:0},dt={key:1},ut=["href"],ct={class:"col-8"},_t={class:"row p-3"},pt={class:"col-12"},ht={data(){return{link:null}},mounted(){this.requestToken()},computed:{user(){return window.user}},methods:{fillVK(){this.$store.dispatch("fillVK").then(n=>{})},requestToken(){this.$store.dispatch("requestVKToken",this.form).then(n=>{this.link=n})}}},kt=Object.assign(ht,{__name:"Dashboard",setup(n){return(s,l)=>(e(),o(p,null,[_(w($),{title:"Панель управления"}),_(b,null,{header:f(()=>l[0]||(l[0]=[t("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Панель управления",-1)])),default:f(()=>[t("div",z,[t("div",A,[t("div",H,[t("div",Q,[t("div",X,[t("div",Y,[t("div",tt,[l[1]||(l[1]=t("h6",{class:"my-2 fw-bold"},"Профиль пользователя",-1)),s.user?(e(),o("ul",st,[t("li",et,i(s.user.name||"Без имени"),1),t("li",ot,i(s.user.email||"Без почты"),1),t("li",nt,[s.user.vk_access_token!=null&&s.user.is_active_token?(e(),o("p",lt,"Тоукен успешно установлен")):(e(),o("p",it,"Тоукен не задан"))]),t("li",rt,[s.user.vk_token_expired_at!=null?(e(),o("p",at,i(s.user.vk_token_expired_at),1)):(e(),o("p",dt,"Тоукен не задан"))])])):d("",!0),s.link?(e(),o("a",{key:1,class:"btn btn-success mt-2 w-100 rounded-2",href:s.link},"Получить токен",8,ut)):d("",!0)])])]),t("div",ct,[_(B)])]),t("div",_t,[t("div",pt,[l[2]||(l[2]=t("h6",{class:"my-2 fw-bold"},"Задачи в очереди",-1)),_(Z)])])])])])]),_:1})],64))}});export{kt as default};
