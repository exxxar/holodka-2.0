import{_ as y}from"./AuthenticatedLayout-DcfgZqqt.js";import{o as e,f as o,b as s,i as m,k,d as h,g as d,v,n as b,e as w,m as $,F as p,l as g,t as r,c as x,a as _,u as j,w as f,Z as J}from"./app-DTPl0w9C.js";import{_ as V}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{P as T}from"./Pagination-D2ooBhEv.js";import"./ApplicationLogo-J6gOX_wV.js";const C={data(){return{link:null,form:{is_only_active:!1,group:null,max_post_count:30}}},computed:{user(){return window.user}},watch:{"form.group":{handler:function(i){if(this.form.group.indexOf("http")!==-1){let t=this.form.group.lastIndexOf("/")+1;this.form.group=this.form.group.substring(t)}},deep:!0}},mounted(){this.requestToken()},methods:{submit(){this.$store.dispatch("addWork",this.form).then(i=>{const t=new CustomEvent("jobs-reload-event");document.dispatchEvent(t)})},requestToken(){this.$store.dispatch("requestVKToken").then(i=>{this.link=i})}}},q={class:"form-floating mb-3"},I={key:0,class:"alert alert-light my-2"},O=["href"],P={class:"d-flex w-100 justify-center"},E={class:"form-check form-switch"},K={class:"form-check-label",for:"is-only-active-users"},B={class:"d-flex w-100 justify-center"},N=["disabled"];function D(i,t,l,n,a,u){return e(),o("form",{onSubmit:t[2]||(t[2]=w((...c)=>u.submit&&u.submit(...c),["prevent"])),class:"mb-2"},[s("div",q,[m(s("input",{type:"text",class:"form-control","onUpdate:modelValue":t[0]||(t[0]=c=>a.form.group=c),id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[k,a.form.group]]),t[3]||(t[3]=s("label",{for:"floatingInput"},"Группа",-1))]),u.user.is_active_token?d("",!0):(e(),o("div",I,[t[4]||(t[4]=h(" Ваш тоукен недействительный! Обновите его! ")),a.link?(e(),o("a",{key:0,class:"btn btn-success mt-2 w-100 rounded-0 p-3",href:a.link},"Получить токен",8,O)):d("",!0)])),s("div",P,[s("div",E,[m(s("input",{"onUpdate:modelValue":t[1]||(t[1]=c=>a.form.is_only_active=c),class:"form-check-input",type:"checkbox",role:"switch",id:"is-only-active-users"},null,512),[[v,a.form.is_only_active]]),s("label",K,[t[5]||(t[5]=h(" Собирать только активных пользователей: ")),s("span",{class:b({"fw-bold text-primary":a.form.is_only_active})},"вкл",2),t[6]||(t[6]=h(" / ")),s("span",{class:b({"fw-bold text-primary":!a.form.is_only_active})},"выкл",2)])])]),s("div",B,[s("button",{disabled:!u.user.is_active_token,class:"btn btn-primary rounded-0"},"Добавить задачу ",8,N)])],32)}const F=V(C,[["render",D]]),M={key:0,class:"row"},L={class:"col-12"},S={class:"table"},U={scope:"row"},z={key:0},G={key:1},R={key:2},W={key:3},Z={key:0},A={key:1},H={key:0},Q={key:1},X=["onClick"],Y={key:1,class:"alert alert-light"},ss={key:2,class:"row mb-3"},ts={class:"col-12"},es={data(){return{current_page:0,jobs:[],pagination:null}},computed:{...$(["getJobs","getJobsPaginateObject"])},mounted(){this.loadJobs(),document.addEventListener("jobs-reload-event",i=>{this.loadJobs()})},methods:{removeJob(i){this.$store.dispatch("removeJob",{id:i.id}).then(t=>{this.loadJobs()})},loadJobs(i=0){this.current_page=i,this.$store.dispatch("loadJobs",{page:this.current_page}).then(t=>{this.jobs=this.getJobs,this.pagination=this.getJobsPaginateObject})}}},os=Object.assign(es,{__name:"JobsTable",setup(i){return(t,l)=>(e(),o(p,null,[t.jobs.length>0?(e(),o("div",M,[s("div",L,[s("table",S,[l[0]||(l[0]=s("thead",null,[s("tr",null,[s("th",{scope:"col"},"#"),s("th",{scope:"col"},"Группа"),s("th",{scope:"col"},"Максимальный охват"),s("th",{scope:"col"},"Собрано пользователей"),s("th",{scope:"col"},"Статус"),s("th",{scope:"col"},"Время выполнения"),s("th",{scope:"col"},"Вариант сбора"),s("th",{scope:"col"},"Дата завершения"),s("th",{scope:"col"},"Дата добавления"),s("th",{scope:"col"},"Действие")])],-1)),s("tbody",null,[(e(!0),o(p,null,g(t.jobs,(n,a)=>(e(),o("tr",null,[s("th",U,r(a+1),1),s("td",null,r(n.group),1),s("td",null,r(n.is_only_active?n.max_post_count:"не ограничено"),1),s("td",null,r(n.result_count),1),s("td",null,[n.status===0?(e(),o("span",z,"Новый")):d("",!0),n.status===1?(e(),o("span",G,"В обработке")):d("",!0),n.status===2?(e(),o("span",R,"Завершено")):d("",!0),n.status===3?(e(),o("span",W,"Ошибка")):d("",!0)]),s("td",null,[n.time_execute?(e(),o("span",Z,r(n.time_execute)+" мин. ",1)):(e(),o("span",A,"Не рассчитано"))]),s("td",null,[n.is_only_active?(e(),o("span",H,"Только активные")):(e(),o("span",Q,"Все"))]),s("td",null,r(n.completed_at||""),1),s("td",null,r(n.created_at),1),s("td",null,[s("button",{onClick:u=>t.removeJob(n),class:"btn btn-danger"},"Удалить",8,X)])]))),256))])])])])):(e(),o("div",Y," Вы еще не добавили задачи в очередь! ")),t.jobs.length>0?(e(),o("div",ss,[s("div",ts,[t.pagination?(e(),x(T,{key:0,onPagination_page:t.loadJobs,pagination:t.pagination},null,8,["onPagination_page","pagination"])):d("",!0)])])):d("",!0)],64))}}),ns={class:"py-12"},is={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},ls={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},rs={class:"row p-3"},as={class:"col-4"},ds={class:"card rounded-0"},us={class:"card-body"},cs={key:0,class:"list-group rounded-0"},_s={class:"list-group-item"},ps={class:"list-group-item"},hs={class:"list-group-item"},ms={key:0},bs={key:1},fs={class:"list-group-item"},gs={key:0},ys={key:1},ks=["href"],vs={class:"alert alert-success mb-2 rounded-0"},ws={class:"col-8"},$s={class:"row p-3"},xs={class:"col-12"},js={data(){return{link:null,company:null,messages:[]}},mounted(){this.requestToken(),this.company=this.user.company||null,pusher.subscribe("my-channel").bind("my-event",t=>{t.userId===this.user.id&&(this.messages.push(t),setTimeout(()=>{window.location.reload()},4e3),this.$notify({title:"Внимание!",text:"Ваше задание #"+t.jobId+" успешно выполнено!",type:"success"}))})},computed:{logo(){return window.logo},user(){return window.user}},methods:{fillVK(){this.$store.dispatch("fillVK").then(i=>{})},storeCompany(){this.$store.dispatch("storeCompany",{company:this.company}).then(i=>{window.location.reload()})},requestToken(){this.$store.dispatch("requestVKToken",this.form).then(i=>{this.link=i})}}},Is=Object.assign(js,{__name:"Dashboard",setup(i){return(t,l)=>(e(),o(p,null,[_(j(J),{title:"Панель управления"}),_(y,null,{header:f(()=>l[0]||(l[0]=[s("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Панель управления",-1)])),default:f(()=>[s("div",ns,[s("div",is,[s("div",ls,[s("div",rs,[s("div",as,[s("div",ds,[s("div",us,[l[1]||(l[1]=s("h6",{class:"my-2 fw-bold"},"Профиль пользователя",-1)),t.user?(e(),o("ul",cs,[s("li",_s,r(t.user.name||"Без имени"),1),s("li",ps,r(t.user.email||"Без почты"),1),s("li",hs,[t.user.vk_access_token!=null&&t.user.is_active_token?(e(),o("p",ms,"Тоукен успешно установлен")):(e(),o("p",bs,"Тоукен не задан"))]),s("li",fs,[t.user.vk_token_expired_at!=null?(e(),o("p",gs,r(t.user.vk_token_expired_at),1)):(e(),o("p",ys,"Тоукен не задан"))])])):d("",!0),t.link&&t.user.company?(e(),o("a",{key:1,class:"btn btn-success mt-2 w-100 rounded-0 p-3",href:t.link},"Получить токен",8,ks)):d("",!0),l[2]||(l[2]=s("hr",{class:"my-2"},null,-1)),(e(!0),o(p,null,g(t.messages,n=>(e(),o("div",vs," Собраны данные по группе "+r(n.group)+" (#"+r(n.jobId)+") ",1))),256))])])]),s("div",ws,[_(F)])]),s("div",$s,[s("div",xs,[l[3]||(l[3]=s("h6",{class:"my-2 fw-bold"},"Задачи в очереди",-1)),_(os)])])])])])]),_:1})],64))}});export{Is as default};
