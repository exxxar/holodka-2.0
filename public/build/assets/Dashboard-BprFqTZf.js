import{o as e,f as n,b as s,i as h,k as _,g as a,e as f,F as m,m as y,l as g,t as r,c as v,a as c,u as k,w as b,Z as w}from"./app-p_AkFrQc.js";import{_ as $}from"./AuthenticatedLayout-DyXtlDRP.js";import{_ as j}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{P as J}from"./Pagination-D8K4xf8R.js";import"./ApplicationLogo-C2nF2R20.js";const C={data(){return{form:{group:null,max_post_count:30}}},computed:{user(){return window.user}},watch:{"form.group":{handler:function(l){if(this.form.group.indexOf("http")!==-1){let t=this.form.group.lastIndexOf("/")+1;this.form.group=this.form.group.substring(t)}},deep:!0}},methods:{submit(){this.$store.dispatch("addWork",this.form).then(l=>{const t=new CustomEvent("jobs-reload-event");document.dispatchEvent(t)})}}},V={class:"form-floating mb-3"},I={class:"form-floating mb-3"},q={key:0,class:"alert alert-light my-2"},O={class:"d-flex w-100 justify-center"},P=["disabled"],E={class:"d-flex w-100 justify-center mb-2"},T=["href"];function B(l,t,o,i,d,u){return e(),n(m,null,[s("form",{onSubmit:t[2]||(t[2]=f((...p)=>u.submit&&u.submit(...p),["prevent"])),class:"mb-2"},[s("div",V,[h(s("input",{type:"text",class:"form-control","onUpdate:modelValue":t[0]||(t[0]=p=>d.form.group=p),id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[_,d.form.group]]),t[3]||(t[3]=s("label",{for:"floatingInput"},"Группа",-1))]),t[5]||(t[5]=s("div",{class:"alert alert-info rounded-0"}," Количество постов, которые можно охватить. Чем больше глубина тем дольше время ожидания обработки. Рекомендуемое значение от 30 до 100 в зависимости от числа подписчиков в группе. Чем больше подписчиков тем ниже должна быть глубина обработки. ",-1)),s("div",I,[h(s("input",{type:"number",class:"form-control","onUpdate:modelValue":t[1]||(t[1]=p=>d.form.max_post_count=p),max:"100",id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[_,d.form.max_post_count]]),t[4]||(t[4]=s("label",{for:"floatingInput"},"Глубина обработки страницы",-1))]),u.user.is_active_token?a("",!0):(e(),n("div",q," Ваш тоукен недействительный! Обновите его! ")),s("div",O,[s("button",{disabled:!u.user.is_active_token,class:"btn btn-primary rounded-0"},"Добавить задачу ",8,P)])],32),s("div",E,[l.link?(e(),n("a",{key:0,class:"btn btn-success rounded-0",href:l.link},"Запустить процесс",8,T)):a("",!0)])],64)}const K=j(C,[["render",B]]),D={key:0,class:"row"},F={class:"col-12"},N={class:"table"},U={scope:"row"},L={key:0},M={key:1},S=["onClick"],x={key:1,class:"alert alert-light"},G={key:2,class:"row mb-3"},R={class:"col-12"},W={data(){return{current_page:0,jobs:[],pagination:null}},computed:{...y(["getJobs","getJobsPaginateObject"])},mounted(){this.loadJobs(),document.addEventListener("jobs-reload-event",l=>{this.loadJobs()})},methods:{removeJob(l){this.$store.dispatch("removeJob",{id:l.id}).then(t=>{this.loadJobs()})},loadJobs(l=0){this.current_page=l,this.$store.dispatch("loadJobs",{page:this.current_page}).then(t=>{this.jobs=this.getJobs,this.pagination=this.getJobsPaginateObject})}}},Z=Object.assign(W,{__name:"JobsTable",setup(l){return(t,o)=>(e(),n(m,null,[t.jobs.length>0?(e(),n("div",D,[s("div",F,[s("table",N,[o[0]||(o[0]=s("thead",null,[s("tr",null,[s("th",{scope:"col"},"#"),s("th",{scope:"col"},"Группа"),s("th",{scope:"col"},"Максимальный охват"),s("th",{scope:"col"},"Собрано пользователей"),s("th",{scope:"col"},"Статус"),s("th",{scope:"col"},"Дата добавления"),s("th",{scope:"col"},"Действие")])],-1)),s("tbody",null,[(e(!0),n(m,null,g(t.jobs,(i,d)=>(e(),n("tr",null,[s("th",U,r(d+1),1),s("td",null,r(i.group),1),s("td",null,r(i.max_post_count),1),s("td",null,r(i.result_count),1),s("td",null,[i.completed_at==null?(e(),n("span",L,"В обработке")):(e(),n("span",M,"Завершено"))]),s("td",null,r(i.created_at),1),s("td",null,[s("button",{onClick:u=>t.removeJob(i),class:"btn btn-danger"},"Удалить",8,S)])]))),256))])])])])):(e(),n("div",x," Вы еще не добавили задачи в очередь! ")),t.jobs.length>0?(e(),n("div",G,[s("div",R,[t.pagination?(e(),v(J,{key:0,onPagination_page:t.loadJobs,pagination:t.pagination},null,8,["onPagination_page","pagination"])):a("",!0)])])):a("",!0)],64))}}),z={class:"py-12"},A={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},H={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Q={class:"row p-3"},X={class:"col-4"},Y={class:"card rounded-0"},ss={class:"card-body"},ts={key:0,class:"list-group rounded-0"},os={class:"list-group-item"},es={class:"list-group-item"},ns={class:"list-group-item"},ls={key:0},is={key:1},rs={class:"list-group-item"},as={key:0},ds={key:1},us={class:"list-group-item"},ps={key:0,class:"alert alert-info rounded-0"},ms={class:"input-group"},cs={class:"form-floating"},hs=["disabled"],_s=["href"],bs={class:"alert alert-success mb-2 rounded-0"},gs={class:"col-8"},fs={class:"row p-3"},ys={class:"col-12"},vs={data(){return{link:null,company:null,messages:[]}},mounted(){this.requestToken(),this.company=this.user.company||null,pusher.subscribe("my-channel").bind("my-event",t=>{t.userId===this.user.id&&(this.messages.push(t),this.$notify({title:"Внимание!",text:"Ваше задание #"+t.jobId+" успешно выполнено!",type:"success"}))})},computed:{logo(){return window.logo},user(){return window.user}},methods:{fillVK(){this.$store.dispatch("fillVK").then(l=>{})},storeCompany(){this.$store.dispatch("storeCompany",{company:this.company}).then(l=>{window.location.reload()})},requestToken(){this.$store.dispatch("requestVKToken",this.form).then(l=>{this.link=l})}}},Cs=Object.assign(vs,{__name:"Dashboard",setup(l){return(t,o)=>(e(),n(m,null,[c(k(w),{title:"Панель управления"}),c($,null,{header:b(()=>o[3]||(o[3]=[s("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Панель управления",-1)])),default:b(()=>[s("div",z,[s("div",A,[s("div",H,[s("div",Q,[s("div",X,[s("div",Y,[s("div",ss,[o[7]||(o[7]=s("h6",{class:"my-2 fw-bold"},"Профиль пользователя",-1)),t.user?(e(),n("ul",ts,[s("li",os,r(t.user.name||"Без имени"),1),s("li",es,r(t.user.email||"Без почты"),1),s("li",ns,[t.user.vk_access_token!=null&&t.user.is_active_token?(e(),n("p",ls,"Тоукен успешно установлен")):(e(),n("p",is,"Тоукен не задан"))]),s("li",rs,[t.user.vk_token_expired_at!=null?(e(),n("p",as,r(t.user.vk_token_expired_at),1)):(e(),n("p",ds,"Тоукен не задан"))]),s("li",us,[o[6]||(o[6]=s("h6",{class:"my-2"},"Ключ компании",-1)),!t.company||t.company.length<6?(e(),n("div",ps," Внимание! Вы должны указать текстовый ключ вашей компании (команды). Это может быть или специально сгенерированный ключ или произвольный ключ длиной от 6 (сейчас "+r((t.company||"").length)+") символов. ",1)):a("",!0),s("div",ms,[s("div",cs,[h(s("input",{type:"text",minlength:"6","onUpdate:modelValue":o[0]||(o[0]=i=>t.company=i),class:"form-control"},null,512),[[_,t.company]]),o[4]||(o[4]=s("label",{for:""},"Ключ компании",-1))]),t.user.company?(e(),n("span",{key:0,onClick:o[1]||(o[1]=(...i)=>t.storeCompany&&t.storeCompany(...i)),class:"input-group-text rounded-0 bg-primary border-black"},o[5]||(o[5]=[s("button",{class:"btn text-white"},[s("i",{class:"bi bi-arrow-repeat"})],-1)]))):a("",!0)]),t.user.company?a("",!0):(e(),n("button",{key:1,onClick:o[2]||(o[2]=(...i)=>t.storeCompany&&t.storeCompany(...i)),disabled:!t.company||(t.company||"").length<6,class:"btn btn-primary rounded-0 p-3 my-2 w-100"},"Сохранить",8,hs))])])):a("",!0),t.link&&t.user.company?(e(),n("a",{key:1,class:"btn btn-success mt-2 w-100 rounded-0 p-3",href:t.link},"Получить токен",8,_s)):a("",!0),o[8]||(o[8]=s("hr",{class:"my-2"},null,-1)),(e(!0),n(m,null,g(t.messages,i=>(e(),n("div",bs," Собраны данные по группе "+r(i.group)+" (#"+r(i.jobId)+") ",1))),256))])])]),s("div",gs,[c(K)])]),s("div",fs,[s("div",ys,[o[9]||(o[9]=s("h6",{class:"my-2 fw-bold"},"Задачи в очереди",-1)),c(Z)])])])])])]),_:1})],64))}});export{Cs as default};
