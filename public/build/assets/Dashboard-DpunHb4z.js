import{_ as y}from"./AuthenticatedLayout-BWU4RsUY.js";import{o as e,f as o,b as s,i as m,k,d as h,g as d,v,n as b,e as w,m as $,F as p,l as g,t as r,c as x,a as _,u as j,w as f,Z as J}from"./app-DYOnf70p.js";import{_ as V}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{P as T}from"./Pagination-BE-M2m7f.js";import"./ApplicationLogo-DnjK_YDh.js";const C={data(){return{link:null,form:{is_only_active:!1,group:null,max_post_count:30}}},computed:{user(){return window.user}},watch:{"form.group":{handler:function(i){if(this.form.group.indexOf("http")!==-1){let t=this.form.group.lastIndexOf("/")+1;this.form.group=this.form.group.substring(t)}},deep:!0}},mounted(){this.requestToken()},methods:{submit(){this.$store.dispatch("addWork",this.form).then(i=>{const t=new CustomEvent("jobs-reload-event");document.dispatchEvent(t)})},requestToken(){this.$store.dispatch("requestVKToken").then(i=>{this.link=i})}}},q={class:"form-floating mb-3"},I={key:0,class:"alert alert-light my-2"},O=["href"],P={class:"d-flex w-100 justify-center"},E={class:"form-check form-switch"},K={class:"form-check-label",for:"is-only-active-users"},B={key:1,class:"alert alert-info rounded-0 my-3"},N={class:"d-flex w-100 justify-center"},D=["disabled"];function F(i,t,l,n,a,u){return e(),o("form",{onSubmit:t[2]||(t[2]=w((...c)=>u.submit&&u.submit(...c),["prevent"])),class:"mb-2"},[s("div",q,[m(s("input",{type:"text",class:"form-control","onUpdate:modelValue":t[0]||(t[0]=c=>a.form.group=c),id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[k,a.form.group]]),t[3]||(t[3]=s("label",{for:"floatingInput"},"Группа",-1))]),u.user.is_active_token?d("",!0):(e(),o("div",I,[t[4]||(t[4]=h(" Ваш тоукен недействительный! Обновите его! ")),a.link?(e(),o("a",{key:0,class:"btn btn-success mt-2 w-100 rounded-0 p-3",href:a.link},"Получить токен",8,O)):d("",!0)])),s("div",P,[s("div",E,[m(s("input",{"onUpdate:modelValue":t[1]||(t[1]=c=>a.form.is_only_active=c),class:"form-check-input",type:"checkbox",role:"switch",id:"is-only-active-users"},null,512),[[v,a.form.is_only_active]]),s("label",K,[t[5]||(t[5]=h(" Собирать только активных пользователей: ")),s("span",{class:b({"fw-bold text-primary":a.form.is_only_active})},"вкл",2),t[6]||(t[6]=h(" / ")),s("span",{class:b({"fw-bold text-primary":!a.form.is_only_active})},"выкл",2)])])]),a.form.is_only_active?d("",!0):(e(),o("p",B," В группе будет обработано не более 30 тыс. пользователей ")),s("div",N,[s("button",{disabled:!u.user.is_active_token,class:"btn btn-primary rounded-0"},"Добавить задачу ",8,D)])],32)}const M=V(C,[["render",F]]),L={key:0,class:"row"},S={class:"col-12"},U={class:"table"},z={scope:"row"},G={key:0},R={key:1},W={key:2},Z={key:3},A={key:0},H={key:1},Q={key:0},X={key:1},Y=["onClick"],ss={key:1,class:"alert alert-light"},ts={key:2,class:"row mb-3"},es={class:"col-12"},os={data(){return{current_page:0,jobs:[],pagination:null}},computed:{...$(["getJobs","getJobsPaginateObject"])},mounted(){this.loadJobs(),document.addEventListener("jobs-reload-event",i=>{this.loadJobs()})},methods:{removeJob(i){this.$store.dispatch("removeJob",{id:i.id}).then(t=>{this.loadJobs()})},loadJobs(i=0){this.current_page=i,this.$store.dispatch("loadJobs",{page:this.current_page}).then(t=>{this.jobs=this.getJobs,this.pagination=this.getJobsPaginateObject})}}},ns=Object.assign(os,{__name:"JobsTable",setup(i){return(t,l)=>(e(),o(p,null,[t.jobs.length>0?(e(),o("div",L,[s("div",S,[s("table",U,[l[0]||(l[0]=s("thead",null,[s("tr",null,[s("th",{scope:"col"},"#"),s("th",{scope:"col"},"Группа"),s("th",{scope:"col"},"Максимальный охват"),s("th",{scope:"col"},"Собрано пользователей"),s("th",{scope:"col"},"Статус"),s("th",{scope:"col"},"Время выполнения"),s("th",{scope:"col"},"Вариант сбора"),s("th",{scope:"col"},"Дата завершения"),s("th",{scope:"col"},"Дата добавления"),s("th",{scope:"col"},"Действие")])],-1)),s("tbody",null,[(e(!0),o(p,null,g(t.jobs,(n,a)=>(e(),o("tr",null,[s("th",z,r(a+1),1),s("td",null,r(n.group),1),s("td",null,r(n.is_only_active?n.max_post_count:"не ограничено"),1),s("td",null,r(n.result_count),1),s("td",null,[n.status===0?(e(),o("span",G,"Новый")):d("",!0),n.status===1?(e(),o("span",R,"В обработке")):d("",!0),n.status===2?(e(),o("span",W,"Завершено")):d("",!0),n.status===3?(e(),o("span",Z,"Ошибка")):d("",!0)]),s("td",null,[n.time_execute?(e(),o("span",A,r(n.time_execute)+" мин. ",1)):(e(),o("span",H,"Не рассчитано"))]),s("td",null,[n.is_only_active?(e(),o("span",Q,"Только активные")):(e(),o("span",X,"Все"))]),s("td",null,r(n.completed_at||""),1),s("td",null,r(n.created_at),1),s("td",null,[s("button",{onClick:u=>t.removeJob(n),class:"btn btn-danger"},"Удалить",8,Y)])]))),256))])])])])):(e(),o("div",ss," Вы еще не добавили задачи в очередь! ")),t.jobs.length>0?(e(),o("div",ts,[s("div",es,[t.pagination?(e(),x(T,{key:0,onPagination_page:t.loadJobs,pagination:t.pagination},null,8,["onPagination_page","pagination"])):d("",!0)])])):d("",!0)],64))}}),is={class:"py-12"},ls={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},rs={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},as={class:"row p-3"},ds={class:"col-4"},us={class:"card rounded-0"},cs={class:"card-body"},_s={key:0,class:"list-group rounded-0"},ps={class:"list-group-item"},hs={class:"list-group-item"},ms={class:"list-group-item"},bs={key:0},fs={key:1},gs={class:"list-group-item"},ys={key:0},ks={key:1},vs=["href"],ws={class:"alert alert-success mb-2 rounded-0"},$s={class:"col-8"},xs={class:"row p-3"},js={class:"col-12"},Js={data(){return{link:null,company:null,messages:[]}},mounted(){this.requestToken(),this.company=this.user.company||null,pusher.subscribe("my-channel").bind("my-event",t=>{t.userId===this.user.id&&(this.messages.push(t),setTimeout(()=>{window.location.reload()},4e3),this.$notify({title:"Внимание!",text:"Ваше задание #"+t.jobId+" успешно выполнено!",type:"success"}))})},computed:{logo(){return window.logo},user(){return window.user}},methods:{fillVK(){this.$store.dispatch("fillVK").then(i=>{})},storeCompany(){this.$store.dispatch("storeCompany",{company:this.company}).then(i=>{window.location.reload()})},requestToken(){this.$store.dispatch("requestVKToken",this.form).then(i=>{this.link=i})}}},Os=Object.assign(Js,{__name:"Dashboard",setup(i){return(t,l)=>(e(),o(p,null,[_(j(J),{title:"Панель управления"}),_(y,null,{header:f(()=>l[0]||(l[0]=[s("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Панель управления",-1)])),default:f(()=>[s("div",is,[s("div",ls,[s("div",rs,[s("div",as,[s("div",ds,[s("div",us,[s("div",cs,[l[1]||(l[1]=s("h6",{class:"my-2 fw-bold"},"Профиль пользователя",-1)),t.user?(e(),o("ul",_s,[s("li",ps,r(t.user.name||"Без имени"),1),s("li",hs,r(t.user.email||"Без почты"),1),s("li",ms,[t.user.vk_access_token!=null&&t.user.is_active_token?(e(),o("p",bs,"Тоукен успешно установлен")):(e(),o("p",fs,"Тоукен не задан"))]),s("li",gs,[t.user.vk_token_expired_at!=null?(e(),o("p",ys,r(t.user.vk_token_expired_at),1)):(e(),o("p",ks,"Тоукен не задан"))])])):d("",!0),t.link&&t.user.company?(e(),o("a",{key:1,class:"btn btn-success mt-2 w-100 rounded-0 p-3",href:t.link},"Получить токен",8,vs)):d("",!0),l[2]||(l[2]=s("hr",{class:"my-2"},null,-1)),(e(!0),o(p,null,g(t.messages,n=>(e(),o("div",ws," Собраны данные по группе "+r(n.group)+" (#"+r(n.jobId)+") ",1))),256))])])]),s("div",$s,[_(M)])]),s("div",xs,[s("div",js,[l[3]||(l[3]=s("h6",{class:"my-2 fw-bold"},"Задачи в очереди",-1)),_(ns)])])])])])]),_:1})],64))}});export{Os as default};
